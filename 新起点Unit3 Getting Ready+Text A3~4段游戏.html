<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜åšèŒä¸šå­¦é™¢ æ–°èµ·ç‚¹Unit 3 Getting Ready+Text A 3~4æ®µè¯æ±‡æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'Arial', sans-serif;
            background: linear-gradient(135deg, #4A148C 0%, #6A1B9A 25%, #8E24AA 50%, #AB47BC 75%, #BA68C8 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            color: white;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="leaves" patternUnits="userSpaceOnUse" width="20" height="20"><circle cx="10" cy="10" r="2" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23leaves)"/></svg>');
            pointer-events: none;
            z-index: -1;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            background: rgba(74, 20, 140, 0.8);
            backdrop-filter: blur(15px);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(186, 104, 200, 0.3);
        }

        .header h1 {
            color: #E1BEE7;
            font-size: 1.8em;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            font-weight: bold;
        }

        .header p {
            color: #CE93D8;
            font-size: 1em;
            font-weight: bold;
        }

        .game-container {
            background: rgba(74, 20, 140, 0.85);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(186, 104, 200, 0.2);
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        .name-input-container {
            margin-bottom: 25px;
        }

        .name-input-container input {
            padding: 15px 25px;
            font-size: 1.2em;
            border: 3px solid #E1BEE7;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            text-align: center;
            width: 100%;
            max-width: 350px;
            margin-bottom: 15px;
        }

        .name-input-container input::placeholder {
            color: rgba(255, 255, 255, 0.8);
        }

        .round-info {
            background: rgba(225, 190, 231, 0.25);
            border: 3px solid #E1BEE7;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            font-size: 1.3em;
            font-weight: bold;
        }

        .player-name {
            color: #E1BEE7;
            font-size: 1.4em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            margin-bottom: 10px;
        }

        .round-status {
            color: #CE93D8;
            margin-bottom: 10px;
        }

        .progress-info {
            color: #A5D6A7;
            font-size: 1.1em;
        }

        .timer-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .timer {
            font-size: 3em;
            font-weight: bold;
            color: #A5D6A7;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        }

        .start-btn {
            padding: 15px 35px;
            font-size: 1.3em;
            background: linear-gradient(45deg, #9C27B0, #E91E63);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 20px rgba(156, 39, 176, 0.4);
            font-weight: bold;
        }

        .start-btn:hover {
            background: linear-gradient(45deg, #7B1FA2, #C2185B);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(156, 39, 176, 0.6);
        }

        .start-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .chinese-word {
            font-size: 2.8em;
            font-weight: bold;
            color: #E1BEE7;
            margin-bottom: 35px;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7);
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(225, 190, 231, 0.1);
            border-radius: 15px;
            padding: 20px;
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .option {
            background: rgba(255, 255, 255, 0.15);
            border: 3px solid rgba(225, 190, 231, 0.4);
            border-radius: 20px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            min-height: 70px;
        }

        .option:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: #E1BEE7;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(225, 190, 231, 0.4);
        }

        .option.correct {
            background: rgba(165, 214, 167, 0.4);
            border-color: #A5D6A7;
            color: #A5D6A7;
        }

        .option.incorrect {
            background: rgba(239, 154, 154, 0.4);
            border-color: #EF9A9A;
            color: #EF9A9A;
        }

        .option-text {
            font-size: 1.2em;
            font-weight: bold;
            flex: 1;
        }

        .feedback {
            font-size: 1.8em;
            font-weight: bold;
            margin: 25px 0;
            padding: 20px;
            border-radius: 15px;
            transition: all 0.3s;
        }

        .feedback.correct {
            background: rgba(165, 214, 167, 0.3);
            color: #A5D6A7;
            border: 3px solid #A5D6A7;
        }

        .feedback.incorrect {
            background: rgba(239, 154, 154, 0.3);
            color: #EF9A9A;
            border: 3px solid #EF9A9A;
        }

        .score-display {
            background: rgba(225, 190, 231, 0.25);
            border: 3px solid #E1BEE7;
            border-radius: 20px;
            padding: 25px;
            margin-top: 25px;
        }

        .score-display h2 {
            color: #E1BEE7;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .score-display p {
            margin: 10px 0;
            font-size: 1.2em;
        }

        .spelling-container {
            text-align: center;
            margin-bottom: 25px;
        }

        .spelling-instruction {
            margin-bottom: 25px;
            color: #E1BEE7;
            font-size: 1.4em;
            font-weight: bold;
        }

        .spelling-input-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .spelling-input-container input {
            padding: 15px 25px;
            font-size: 1.3em;
            border: 3px solid #E1BEE7;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            text-align: center;
            width: 350px;
            max-width: 100%;
        }

        .spelling-input-container input::placeholder {
            color: rgba(255, 255, 255, 0.8);
        }

        .spelling-input-container input:focus {
            outline: none;
            border-color: #A5D6A7;
            box-shadow: 0 0 15px rgba(165, 214, 167, 0.4);
        }

        .spelling-btn {
            padding: 15px 25px;
            font-size: 1.2em;
            background: linear-gradient(45deg, #A5D6A7, #66BB6A);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .spelling-btn:hover {
            background: linear-gradient(45deg, #81C784, #4CAF50);
            transform: translateY(-2px);
        }

        .spelling-hint {
            color: #E1BEE7;
            font-size: 1.1em;
            min-height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (max-width: 768px) {
            body {
                padding: 5px;
            }

            .game-container {
                padding: 20px;
            }

            .header h1 {
                font-size: 1.5em;
            }

            .chinese-word {
                font-size: 2.2em;
                min-height: 70px;
                padding: 15px;
            }

            .options-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .option {
                padding: 15px;
                min-height: 60px;
            }

            .option-text {
                font-size: 1.1em;
            }

            .spelling-input-container {
                flex-direction: column;
                gap: 10px;
            }

            .spelling-input-container input {
                width: 100%;
            }

            .timer {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>é«˜åšèŒä¸šå­¦é™¢ æ–°èµ·ç‚¹Unit 3 Getting Ready+Text A 3~4æ®µè¯æ±‡æ¸¸æˆ</h1>
        <p>ğŸ’œ New Start English ğŸ’œ</p>
    </div>

    <div class="game-container" id="gameContainer">
        <div class="name-input-container">
            <input type="text" id="playerName" placeholder="è¯·è¾“å…¥ä½ çš„å§“å" maxlength="20">
            <button class="start-btn" onclick="startGameSetup()">å¼€å§‹æ¸¸æˆ</button>
        </div>

        <div class="round-info" id="roundInfo" style="display: none;">
            <div class="player-name" id="playerNameDisplay">ç©å®¶</div>
            <div class="round-status">
                å…³å¡ <span id="currentRound">1</span> - å¾—åˆ†: <span id="currentScore">0</span>
            </div>
            <div class="progress-info">
                è¿›åº¦: <span id="currentProgress">0</span> / <span id="totalQuestions">35</span>
            </div>
        </div>

        <div class="timer-container" id="timerContainer" style="display: none;">
            <div class="timer" id="timer">00:00</div>
        </div>

        <div class="chinese-word" id="chineseWord">å‡†å¤‡å¼€å§‹è¯æ±‡æŒ‘æˆ˜</div>

        <div class="options-container" id="optionsContainer" style="display: none;">
            <div class="option" id="option0" onclick="selectOption(0)">
                <div class="option-text" id="optionText0">Option 1</div>
            </div>
            <div class="option" id="option1" onclick="selectOption(1)">
                <div class="option-text" id="optionText1">Option 2</div>
            </div>
            <div class="option" id="option2" onclick="selectOption(2)">
                <div class="option-text" id="optionText2">Option 3</div>
            </div>
            <div class="option" id="option3" onclick="selectOption(3)">
                <div class="option-text" id="optionText3">Option 4</div>
            </div>
        </div>

        <div class="spelling-container" id="spellingContainer" style="display: none;">
            <div class="spelling-instruction">
                è¯·æ ¹æ®ä¸­æ–‡æ„æ€æ‹¼å†™è‹±æ–‡å•è¯
            </div>
            <div class="spelling-input-container">
                <input type="text" id="spellingInput" placeholder="è¯·è¾“å…¥è‹±æ–‡å•è¯" autocomplete="off" spellcheck="false">
                <button class="spelling-btn" onclick="checkSpelling()">æ£€æŸ¥</button>
            </div>
            <div class="spelling-hint" id="spellingHint"></div>
        </div>

        <div class="controls">
            <button class="start-btn" id="startBtn" onclick="handleStartButton()" disabled>å¼€å§‹æŒ‘æˆ˜</button>
        </div>

        <div class="feedback" id="feedback"></div>
        <div class="score-display" id="scoreDisplay" style="display: none;"></div>
    </div>

    <script>
        // è¯æ±‡æ•°æ®
        const vocabulary = [
            {word: "unhappy", meaning: "adj.ä¸å¿«ä¹çš„"},
            {word: "scientist", meaning: "n.ç§‘å­¦å®¶"},
            {word: "caught", meaning: "v.æŠ“ä½ï¼ˆè¿‡å»å¼ï¼‰"},
            {word: "microscope", meaning: "n.æ˜¾å¾®é•œ"},
            {word: "influenza", meaning: "n.æµæ„Ÿ"},
            {word: "virus", meaning: "n.ç—…æ¯’"},
            {word: "dangerous", meaning: "adj.å±é™©çš„"},
            {word: "guy", meaning: "n.å®¶ä¼™"},
            {word: "vegetables", meaning: "n.è”¬èœ"},
            {word: "exercising", meaning: "v.é”»ç‚¼ï¼ˆç°åœ¨åˆ†è¯ï¼‰"},
            {word: "strong", meaning: "adj.å¼ºå£®çš„"},
            {word: "Wednesday", meaning: "n.æ˜ŸæœŸä¸‰"},
            {word: "January", meaning: "n.ä¸€æœˆ"},
            {word: "anyway", meaning: "adv.æ— è®ºå¦‚ä½•"},
            {word: "exercise", meaning: "n./v.é”»ç‚¼"},
            {word: "Thursday", meaning: "n.æ˜ŸæœŸå››"},
            {word: "infect", meaning: "v.æ„ŸæŸ“"},
            {word: "five times", meaning: "äº”æ¬¡"},
            {word: "touch one's face", meaning: "æ‘¸è„¸"},
            {word: "tissue", meaning: "n.çº¸å·¾"},
            {word: "sneeze", meaning: "v.æ‰“å–·åš"},
            {word: "impossible", meaning: "adj.ä¸å¯èƒ½çš„"},
            {word: "cold", meaning: "n.æ„Ÿå†’"},
            {word: "give up", meaning: "æ”¾å¼ƒ"},
            {word: "touched", meaning: "v.è§¦æ‘¸ï¼ˆè¿‡å»å¼ï¼‰"},
            {word: "toe", meaning: "n.è„šè¶¾"},
            {word: "ankle", meaning: "n.è„šè¸"},
            {word: "fingernail", meaning: "n.æŒ‡ç”²"},
            {word: "forehead", meaning: "n.å‰é¢"},
            {word: "wrist", meaning: "n.æ‰‹è…•"},
            {word: "sprain", meaning: "v.æ‰­ä¼¤"},
            {word: "dizzy", meaning: "adj.å¤´æ™•çš„"},
            {word: "twist", meaning: "v.æ‰­"},
            {word: "swell", meaning: "v.è‚¿èƒ€"}
        ];

        // é«˜ä¸­è¯æ±‡å¹²æ‰°é¡¹
        const distractors = [
            "abandon", "ability", "absolute", "academic", "accept", "access", "accident", "accompany", "accomplish", "account",
            "accurate", "achieve", "acquire", "action", "active", "actual", "adapt", "add", "address", "adequate",
            "adjust", "administration", "admit", "adopt", "adult", "advance", "advantage", "adventure", "advertise", "advice",
            "affect", "afford", "afraid", "after", "again", "against", "age", "agency", "agent", "agree",
            "agriculture", "ahead", "aid", "aim", "air", "aircraft", "airline", "airport", "alarm", "album",
            "alcohol", "alert", "alien", "align", "alike", "alive", "all", "allow", "almost", "alone",
            "along", "already", "also", "alter", "alternative", "although", "altogether", "always", "amazing", "ambition",
            "ambulance", "among", "amount", "analysis", "analyze", "ancient", "anger", "angle", "angry", "animal",
            "anniversary", "announce", "annual", "another", "answer", "anticipate", "anxiety", "anxious", "any", "anybody",
            "anyone", "anything", "anyway", "anywhere", "apart", "apartment", "apparent", "appeal", "appear", "apple",
            "application", "apply", "appoint", "appreciate", "approach", "appropriate", "approve", "approximately", "area", "argue",
            "argument", "arise", "arm", "army", "around", "arrange", "arrest", "arrival", "arrive", "art",
            "article", "artist", "artistic", "as", "ash", "ask", "aspect", "assess", "assign", "assist",
            "associate", "association", "assume", "assure", "astonish", "at", "athlete", "atmosphere", "atom", "attach",
            "attack", "attempt", "attend", "attention", "attitude", "attract", "attractive", "audience", "author", "authority",
            "automatic", "available", "average", "avoid", "awake", "award", "aware", "away", "awful", "baby",
            "back", "background", "backward", "bacteria", "bad", "badly", "bag", "balance", "ball", "ban",
            "band", "bank", "bar", "bare", "bargain", "barrier", "base", "basic", "basically", "basis",
            "basket", "bath", "bathroom", "battery", "battle", "be", "beach", "bear", "beat", "beautiful",
            "beauty", "because", "become", "bed", "bedroom", "bee", "beef", "beer", "before", "begin",
            "beginning", "behalf", "behave", "behavior", "behind", "being", "belief", "believe", "bell", "belong",
            "below", "belt", "bench", "bend", "beneath", "benefit", "beside", "best", "better", "between",
            "beyond", "bicycle", "bid", "big", "bike", "bill", "billion", "bind", "biological", "bird",
            "birth", "birthday", "bit", "bite", "bitter", "black", "blade", "blame", "blank", "blanket",
            "blind", "block", "blood", "blow", "blue", "board", "boat", "body", "boil", "bold",
            "bomb", "bond", "bone", "book", "boom", "boost", "boot", "border", "bore", "born",
            "borrow", "boss", "both", "bother", "bottle", "bottom", "bound", "bow", "bowl", "box",
            "boy", "brain", "branch", "brand", "brave", "bread", "break", "breakfast", "breast", "breath",
            "breathe", "breed", "brick", "bridge", "brief", "bright", "brilliant", "bring", "broad", "broken",
            "brother", "brown", "brush", "budget", "build", "building", "bullet", "bunch", "burden", "burn",
            "burst", "bury", "bus", "business", "busy", "but", "butter", "button", "buy", "buyer"
        ];

        // æ¸¸æˆçŠ¶æ€å˜é‡
        let playerName = '';
        let currentRound = 1;
        let currentScore = 0;
        let questionsPerRound = vocabulary.length;
        let totalRounds = 2;
        let currentQuestion = 0;
        let correctAnswers = 0;
        let timer;
        let gameActive = false;
        let roundWords = [];
        let gameStartTime = 0;
        let isSpellingMode = false;
        let currentSpellingWord = null;
        let round1Score = 0;
        let round2Score = 0;

        // DOMå…ƒç´ 
        const gameContainer = document.getElementById('gameContainer');
        const chineseWord = document.getElementById('chineseWord');
        const optionsContainer = document.getElementById('optionsContainer');
        const timerContainer = document.getElementById('timerContainer');
        const timerDisplay = document.getElementById('timer');
        const roundInfo = document.getElementById('roundInfo');
        const currentRoundSpan = document.getElementById('currentRound');
        const currentScoreSpan = document.getElementById('currentScore');
        const startBtn = document.getElementById('startBtn');
        const feedback = document.getElementById('feedback');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const spellingContainer = document.getElementById('spellingContainer');
        const spellingInput = document.getElementById('spellingInput');
        const spellingHint = document.getElementById('spellingHint');
        const playerNameDisplay = document.getElementById('playerNameDisplay');
        const currentProgress = document.getElementById('currentProgress');
        const totalQuestions = document.getElementById('totalQuestions');

        // åˆå§‹åŒ–æ¸¸æˆ
        function startGameSetup() {
            playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                alert('è¯·è¾“å…¥ä½ çš„å§“åï¼');
                return;
            }

            document.querySelector('.name-input-container').style.display = 'none';
            roundInfo.style.display = 'block';
            playerNameDisplay.textContent = playerName;
            totalQuestions.textContent = vocabulary.length;

            startGame();
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            gameStartTime = Date.now();
            startGameTimer();
            
            currentQuestion = 0;
            correctAnswers = 0;
            roundWords = shuffleArray([...vocabulary]);
            gameActive = true;

            currentRoundSpan.textContent = currentRound;
            currentScoreSpan.textContent = currentScore;

            if (currentRound === 1) {
                isSpellingMode = false;
                optionsContainer.style.display = 'grid';
                spellingContainer.style.display = 'none';
                showQuestion();
            } else {
                isSpellingMode = true;
                optionsContainer.style.display = 'none';
                spellingContainer.style.display = 'block';
                showSpellingQuestion();
            }
            
            timerContainer.style.display = 'block';
        }

        // æ¸¸æˆè®¡æ—¶å™¨
        function startGameTimer() {
            timer = setInterval(() => {
                const gameTime = Math.floor((Date.now() - gameStartTime) / 1000);
                const minutes = Math.floor(gameTime / 60);
                const seconds = gameTime % 60;
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // æ˜¾ç¤ºé¢˜ç›®
        function showQuestion() {
            const currentWord = roundWords[currentQuestion];
            chineseWord.textContent = currentWord.meaning;

            const options = generateOptions(currentWord);
            const shuffledOptions = shuffleArray(options);

            for (let i = 0; i < 4; i++) {
                const optionElement = document.getElementById(`option${i}`);
                const optionText = document.getElementById(`optionText${i}`);

                optionText.textContent = shuffledOptions[i].word;
                optionElement.className = 'option';
                optionElement.style.pointerEvents = 'auto';
            }

            updateProgress();
        }

        // ç”Ÿæˆé€‰é¡¹
        function generateOptions(correctWord) {
            const options = [correctWord];
            const usedDistractors = new Set([correctWord.word]);

            while (options.length < 4) {
                const randomIndex = Math.floor(Math.random() * distractors.length);
                const distractor = distractors[randomIndex];

                if (!usedDistractors.has(distractor)) {
                    options.push({word: distractor, meaning: ''});
                    usedDistractors.add(distractor);
                }
            }

            return options;
        }

        // é€‰æ‹©ç­”æ¡ˆ
        function selectOption(optionIndex) {
            if (!gameActive) return;

            gameActive = false;

            const currentWord = roundWords[currentQuestion];
            const selectedOption = document.getElementById(`option${optionIndex}`);
            const selectedText = document.getElementById(`optionText${optionIndex}`).textContent;

            if (selectedText === currentWord.word) {
                correctAnswers++;
                currentScore += 10;
                selectedOption.classList.add('correct');
                showFeedback('æ­£ç¡®ï¼ğŸ‰', 'correct');
                playCorrectSound();
            } else {
                selectedOption.classList.add('incorrect');
                for (let i = 0; i < 4; i++) {
                    const optionText = document.getElementById(`optionText${i}`).textContent;
                    if (optionText === currentWord.word) {
                        document.getElementById(`option${i}`).classList.add('correct');
                        break;
                    }
                }
                showFeedback('é”™è¯¯ï¼âŒ', 'incorrect');
                playIncorrectSound();
            }

            currentScoreSpan.textContent = currentScore;

            setTimeout(() => {
                nextQuestion();
            }, 1500);
        }

        // æ˜¾ç¤ºæ‹¼å†™é¢˜ç›®
        function showSpellingQuestion() {
            if (currentQuestion >= questionsPerRound) {
                endRound();
                return;
            }

            currentSpellingWord = roundWords[currentQuestion];
            
            const wordLength = currentSpellingWord.word.length;
            const blanks = '_'.repeat(wordLength);
            chineseWord.textContent = `${currentSpellingWord.meaning} â†’ ${blanks}`;
            
            spellingInput.value = '';
            spellingHint.textContent = `æç¤ºï¼šå•è¯æœ‰ ${wordLength} ä¸ªå­—æ¯`;
            spellingInput.focus();
            
            updateProgress();
        }

        // æ›´æ–°è¿›åº¦æ˜¾ç¤º
        function updateProgress() {
            currentProgress.textContent = currentQuestion + 1;
        }

        // æ£€æŸ¥æ‹¼å†™
        function checkSpelling() {
            if (!gameActive) return;

            const userInput = spellingInput.value.trim().toLowerCase();
            const correctWord = currentSpellingWord.word.toLowerCase();

            if (userInput === correctWord) {
                correctAnswers++;
                currentScore += 10;
                spellingHint.textContent = 'æ­£ç¡®ï¼ğŸ‰';
                spellingHint.style.color = '#A5D6A7';
                chineseWord.textContent = `${currentSpellingWord.meaning} â†’ ${currentSpellingWord.word}`;
                playCorrectSound();
            } else {
                spellingHint.textContent = `é”™è¯¯ï¼æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${currentSpellingWord.word}`;
                spellingHint.style.color = '#EF9A9A';
                chineseWord.textContent = `${currentSpellingWord.meaning} â†’ ${currentSpellingWord.word}`;
                playIncorrectSound();
            }

            currentScoreSpan.textContent = currentScore;
            gameActive = false;

            setTimeout(() => {
                nextSpellingQuestion();
            }, 2500);
        }

        // ä¸‹ä¸€é“æ‹¼å†™é¢˜
        function nextSpellingQuestion() {
            currentQuestion++;

            if (currentQuestion >= questionsPerRound) {
                endRound();
            } else {
                setTimeout(() => {
                    showSpellingQuestion();
                    gameActive = true;
                }, 500);
            }
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            currentQuestion++;

            if (currentQuestion >= questionsPerRound) {
                endRound();
            } else {
                setTimeout(() => {
                    if (isSpellingMode) {
                        showSpellingQuestion();
                    } else {
                        showQuestion();
                    }
                    gameActive = true;
                }, 500);
            }
        }

        // ç»“æŸæ¸¸æˆ
        function endRound() {
            clearInterval(timer);
            optionsContainer.style.display = 'none';
            spellingContainer.style.display = 'none';
            timerContainer.style.display = 'none';

            const questionsAnswered = currentQuestion;
            const accuracy = questionsAnswered > 0 ? Math.round((correctAnswers / questionsAnswered) * 100) : 0;
            const finalTime = Math.floor((Date.now() - gameStartTime) / 1000);
            const minutes = Math.floor(finalTime / 60);
            const seconds = finalTime % 60;

            if (currentRound === 1) {
                round1Score = correctAnswers;
            } else {
                round2Score = correctAnswers;
            }

            if (currentRound < totalRounds) {
                const roundType = currentRound === 1 ? 'é€‰æ‹©é¢˜' : 'æ‹¼å†™é¢˜';
                scoreDisplay.innerHTML = `
                    <h2>ç¬¬${currentRound}è½®å®Œæˆï¼</h2>
                    <p><strong>${playerName}</strong></p>
                    <p>æ¸¸æˆç±»å‹: ${roundType}</p>
                    <p>ç”¨æ—¶: ${minutes}åˆ†${seconds}ç§’</p>
                    <p>ç­”é¢˜æ•°: ${questionsAnswered}</p>
                    <p>å¾—åˆ†: ${correctAnswers}/${questionsAnswered}</p>
                    <p>å‡†ç¡®ç‡: ${accuracy}%</p>
                    <p>å½“å‰æ€»åˆ†: ${currentScore}</p>
                `;
                scoreDisplay.style.display = 'block';

                chineseWord.textContent = `ç¬¬${currentRound}è½®å®Œæˆï¼ç‚¹å‡»å¼€å§‹ä¸‹ä¸€è½®`;
                startBtn.textContent = 'å¼€å§‹ä¸‹ä¸€è½®';
                startBtn.disabled = false;
                startBtn.style.display = 'block';
                
                currentRound++;
                currentQuestion = 0;
                correctAnswers = 0;
            } else {
                scoreDisplay.innerHTML = `
                    <h2>æ¸¸æˆå®Œæˆï¼</h2>
                    <p><strong>${playerName}</strong></p>
                    <p>æ€»ç”¨æ—¶: ${minutes}åˆ†${seconds}ç§’</p>
                    <p>ç¬¬ä¸€è½®ï¼ˆé€‰æ‹©é¢˜ï¼‰å¾—åˆ†: ${round1Score}/${vocabulary.length}</p>
                    <p>ç¬¬äºŒè½®ï¼ˆæ‹¼å†™é¢˜ï¼‰å¾—åˆ†: ${round2Score}/${vocabulary.length}</p>
                    <p>æ€»å¾—åˆ†: ${round1Score + round2Score}/${vocabulary.length * 2}</p>
                    <p>å‡†ç¡®ç‡: ${Math.round(((round1Score + round2Score) / (vocabulary.length * 2)) * 100)}%</p>
                `;
                scoreDisplay.style.display = 'block';

                chineseWord.textContent = `æ­å–œ ${playerName}ï¼æ¸¸æˆå®Œæˆï¼æœ€ç»ˆå¾—åˆ†: ${round1Score + round2Score}`;
                startBtn.textContent = 'æ¸¸æˆå®Œæˆï¼';
                startBtn.disabled = true;
                startBtn.style.display = 'block';
            }
        }

        // æ˜¾ç¤ºåé¦ˆä¿¡æ¯
        function showFeedback(message, type) {
            feedback.textContent = message;
            feedback.className = `feedback ${type}`;
            feedback.style.display = 'block';

            setTimeout(() => {
                feedback.style.display = 'none';
            }, 1500);
        }

        // æ’­æ”¾æ­£ç¡®éŸ³æ•ˆ
        function playCorrectSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
            oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        // æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
        function playIncorrectSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.2);
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.2);
        }

        // æ•°ç»„æ´—ç‰Œå‡½æ•°
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // å¤„ç†å¼€å§‹æŒ‰é’®ç‚¹å‡»
        function handleStartButton() {
            startGame();
        }

        // æ‹¼å†™è¾“å…¥æ¡†é”®ç›˜äº‹ä»¶
        spellingInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkSpelling();
            }
        });

        // åˆå§‹åŒ–æ¸¸æˆå®¹å™¨æ˜¾ç¤º
        window.addEventListener('load', function() {
            gameContainer.style.display = 'block';
        });
    </script>
</body>
</html>
